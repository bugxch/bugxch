<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>git - 标签 - 致力于把技术要点写清楚</title>
        <link>https://bugxch.github.io/tags/git/</link>
        <description>git - 标签 - 致力于把技术要点写清楚</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>bugxch@126.com (bugxch)</managingEditor>
            <webMaster>bugxch@126.com (bugxch)</webMaster><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Sat, 21 Jul 2018 20:26:54 &#43;0000</lastBuildDate><atom:link href="https://bugxch.github.io/tags/git/" rel="self" type="application/rss+xml" /><item>
    <title>Git学习笔记（一）</title>
    <link>https://bugxch.github.io/git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%80/</link>
    <pubDate>Sat, 21 Jul 2018 20:26:54 &#43;0000</pubDate><author>
        <name>bugxch</name>
    </author><guid>https://bugxch.github.io/git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%80/</guid>
    <description><![CDATA[<p>git笔记记录。</p>
<p></p>
<p>git 是目前全世界最流行的分布式版本控制工具，与之前的集中化的版本控制系统相比，它有如下的优势</p>
<ol>
<li>项目管理更安全。集中式版本控制系统，只要服务器崩溃，那所有人的代码都将丢失。git 的每个项目参与者都会在自己的本地保存一份完整的代码备份，即便其中的一个或者多个电脑出现问题，依然可以通过其他人的代码恢复。</li>
<li>不需要联网也可以管理。git 在本地有一套自己完整的版本管理机制，即便断网程序员也可以在本地进行修改，添加或者删除文件，将自己的代码提交到本地的版本库，所有的操作都被忠实得记录在本地版本库中，到时候只要联网恢复，将本地的所有修改 push 到远端的服务器即可。</li>
</ol>
<h2 id="核心概念">核心概念</h2>
<p>git 的版本管理基于如下的概念框架，只有掌握这些概念才能理解它指令之后的真正含义。核心的 git 框架如下图所示</p>
<p></p>
<p>我们先不用管其中的横向的命令，仅仅关注其中的 4 个圆柱体，分别代表不同的实体，本地包括 workspace, index 和 local repository 三个部分，在服务器端有 remote repository，下面分别详细介绍它们</p>
<ul>
<li>workspace， 本地的工作目录，它是 Git 用来保存元数据和对象数据库的地方，添加，修改，删除等操作就在这个目录里面进行；</li>
<li>index， 暂存区域，这是 git 的缓存机制，在 workspace 的修改可以暂存在这个区域；</li>
<li>local repository，本地仓库，我们将 index 区域的代码提交到本地仓库，就完成一次完整的修改。</li>
<li>remote repository，远端仓库，这是远端服务器存放代码的地方，比如现在非常流行的 <a href="https://github.com/" target="_blank" rel="noopener noreffer">GitHub</a>，可以将本地仓库的代码推送到远端仓库，供其他人浏览和下载。</li>
</ul>
<h3 id="文件状态">文件状态</h3>
<p>workspace 里面的文件无外乎两种状态：已跟踪或者未跟踪。如果文件已经被纳入到版本管理中就为已跟踪，直观的理解就是之前在版本库里添加或者提交过该文件，版本库有该文件的记录，它已经感知到该文件的存在；如果该文件从未提交或者添加到版本库中，那么它就是未被跟踪的。</p>
<p></p>
<p>如下图所示，比如你在 workspace 里面新建了一个文件，之后没有任何动作，此时该文件是未跟踪状态，但是如果你将它添加到暂存区域，或者之后又提交到本地仓库，那么就变成了已跟踪状态。</p>
<h2 id="基本流程">基本流程</h2>
<p>下面我们结合具体的实例，介绍下使用 git 在本地进行版本管理的流程，重点是熟悉基本的操作以及其中所用到的指令。我最近在学习 C++，需要根据《C++ primer plus》写一些小程序进行练习，及时记录学习的进度，所以我自己在本地新建一个 git 仓库管理这些文件。</p>
<h3 id="创建-git-仓库">创建 git 仓库</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="n">git</span> <span class="n">init</span>         <span class="c1">//创建新仓库
</span><span class="c1"></span><span class="n">git</span> <span class="n">clone</span> <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span>  <span class="c1">//从url上下载已有的仓库
</span></code></pre></td></tr></table>
</div>
</div><p>这是使用 git 的基础，我们有两种方式创建仓库</p>
<ul>
<li>
<p>本地新建。我在本地创建文件夹 C++ primer plus，然后在 windows 下切换到该目录下，使用敲入<code>git init</code>，命令行提示</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git init
Initialized empty Git repository in D:/Study/C++ primer plus/.git/
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>初始化后，在当前目录下会出现一个名为<code>.git</code>的目录，所有 Git 需要的数据和资源都存放在这个目录中。，<strong>自己不要去修改它</strong>。</p>
<ul>
<li>远端下载。我可如果想对某个开源项目出一份力，可以先把该项目的 Git 仓库复制一份出来，这就需要用到 <code>git clone</code> 命令。比如我想将 ss-qt5 的代码拉下来，可以使用如下的指令<code>git clone git@github.com:shadowsocks/shadowsocks-qt5.git</code>，拉下来的基本格式是<code>git clone [url]</code>，之后在我的本地电脑就有一份完整的该项目的代码</li>
</ul>
<h3 id="检查文件状态">检查文件状态</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">git status
</code></pre></td></tr></table>
</div>
</div><p>在添加文件之前，先介绍一个非常有用的命令<code>git status</code>，它可以查看当前版本库中的所有文件状态，包括已跟踪或者未跟踪的文件。</p>
<blockquote>
<p><code>git status</code>会将 workspace 和暂存区的文件比对，同时比对本地仓库有暂存区的文件。</p>
</blockquote>
<p>在当前的目录下，敲入该命令，输出如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git status
On branch master
nothing to commit, working directory clean
</code></pre></td></tr></table>
</div>
</div><p>这个提示说明，现在的工作目录相当干净，所以已经跟踪的文件在上次提交之后没有被修改过。而且，在当前的目录中没有任何还没有被跟踪的新文件，当前工作的分支是<code>master</code>，凡事本地创建分支默认都是这个名字，后续分支管理可以改变分支，下篇再介绍。</p>
<h3 id="添加文件">添加文件</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">git add &lt;file&gt; //添加并跟踪文件file（的修改）
git add .      //将workspace中的所有文件添加到暂存区
</code></pre></td></tr></table>
</div>
</div><p>创建本地仓库之后，就可以在仓库里面添加文件了。我在仓库里面新建<code>readme.txt</code>文件，并在文件中写入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">This is the 1st line of the file.
</code></pre></td></tr></table>
</div>
</div><p>使用<code>git status</code>查看当前的窗台状态，显示如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git status
On branch master
Initial commit
Untracked files:
  <span class="o">(</span>use <span class="s2">&#34;git add &lt;file&gt;...&#34;</span> to include in what will be committed<span class="o">)</span>
        readme.txt
nothing added to commit but untracked files present <span class="o">(</span>use <span class="s2">&#34;git add&#34;</span> to track<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>显示可能会有差异，我将其中的空行去掉了，这段话表明当前文件<code>readme.txt</code>还没有被跟踪 (untracked)，当前没有文件需要添加，使用<code>git add &lt;file&gt;</code>将其跟踪。那我们使用<code>git add readme.txt</code>跟踪该文件，命令行没有任何回应，表明一切正常。之后再次使用<code>git status</code>查看如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git status
On branch master
Initial commit
Changes to be committed:
  <span class="o">(</span>use <span class="s2">&#34;git rm --cached &lt;file&gt;...&#34;</span> to unstage<span class="o">)</span>
        new file:   readme.txt
</code></pre></td></tr></table>
</div>
</div><p>显示当前的<code>readme.txt</code>已经进入暂存区，该文件可以被 committed。</p>
<blockquote>
<p>**git add 的潜台词就是把目标文件快照放入暂存区域，也就是 add file into staged area，同时未曾跟踪过的文件标记为需要跟踪。**如果一次需要添加所有的文件，可以使用<code>git add .</code>，其中的<code>.</code>表示当前工作区中的所有文件。</p>
</blockquote>
<p>我继续修改<code>readme.txt</code>文件，添加一行<code>this is the 2nd line</code>，之后再添加文件<code>test.cc</code>，查看文件状态，显示如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git status
On branch master

Initial commit

Changes to be committed:
  <span class="o">(</span>use <span class="s2">&#34;git rm --cached &lt;file&gt;...&#34;</span> to unstage<span class="o">)</span>

        new file:   readme.txt

Changes not staged <span class="k">for</span> commit:
  <span class="o">(</span>use <span class="s2">&#34;git add &lt;file&gt;...&#34;</span> to update what will be committed<span class="o">)</span>
  <span class="o">(</span>use <span class="s2">&#34;git checkout -- &lt;file&gt;...&#34;</span> to discard changes in working directory<span class="o">)</span>

        modified:   readme.txt

Untracked files:
  <span class="o">(</span>use <span class="s2">&#34;git add &lt;file&gt;...&#34;</span> to include in what will be committed<span class="o">)</span>

        test.cc
</code></pre></td></tr></table>
</div>
</div><p>这里有比较有意思的地方，<code>test.cc</code>与之前的<code>readme.txt</code>一样，后来新加的文件，因此它显示该文件未被跟踪。这里需要详细说明一下<code>readme.txt</code>，现在在 workspace 和 index 的暂存区都有该文件，但是两个文件的内容不同，workspace 中的是最新的修改版本，包含了第 2 行，但是 index 中的仅仅包含第一行（因为第 2 次修改之后还没有<code>git add</code>），所以才会有两条显示信息。</p>
<ol>
<li>
<p>暂存区与本地版本库相比，还有些修改 (第 1 行) 没有 commit;</p>
</li>
<li>
<p>workspace 与暂存区相比，还有些修改 (第 2 行) 没有被跟踪。</p>
<p>所以，可以看出 <strong>git 记录的是文件的修改而不是文件本身</strong>。现在使用<code>git add readme.txt</code>则将会把 workspace 中的新修改一并跟踪并记录在暂存区中，如下所示</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git status
On branch master
Initial commit
Changes to be committed:
  <span class="o">(</span>use <span class="s2">&#34;git rm --cached &lt;file&gt;...&#34;</span> to unstage<span class="o">)</span>
        new file:   readme.txt
Untracked files:
  <span class="o">(</span>use <span class="s2">&#34;git add &lt;file&gt;...&#34;</span> to include in what will be committed<span class="o">)</span>
        test.cc
</code></pre></td></tr></table>
</div>
</div><p>此时的<code>readme.txt</code>已经是 to be committed 状态了，之前的 workspace 中的修改已经被跟踪了。</p>
<h3 id="提交修改">提交修改</h3>
<p>提交修改就是将暂存区的文件以及它们的修改提交到本地仓库，使用<code>git commit -m &quot;balabla&quot;</code>，该命令将所有的暂存区中的文件提交到本地仓库，双引号中的字符是提交的说明，输入该命令将<code>readme.txt</code>提交到本地仓库，如下所示</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">git commit -m <span class="s2">&#34;1st commit&#34;</span>
<span class="o">[</span>master 7aecba8<span class="o">]</span> 1st commit
 <span class="m">2</span> files changed, <span class="m">1</span> insertion<span class="o">(</span>+<span class="o">)</span>, <span class="m">1</span> deletion<span class="o">(</span>-<span class="o">)</span>
 create mode <span class="m">100644</span> test.cc
</code></pre></td></tr></table>
</div>
</div><p>表示暂存区的所有文件已经提交，此时查看状态如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">git status
On branch master
nothing to commit, working directory clean
</code></pre></td></tr></table>
</div>
</div><p>说明工作区很干净，workspace/index/local repository 三个区的所有东西都是一致的没有任何的差异。</p>
<h3 id="查看提交历史">查看提交历史</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">git log  //查看提交历史
gitk     //图形化界面查看提交历史
</code></pre></td></tr></table>
</div>
</div><p>在下一节之前，先学会查看本地的提交历史，使用<code>git log</code>可以查看本仓库的从最近到最远的所有提交历史，如下图所示【图片暂缺】</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git log
commit 1655db95f38ef46cf846e4e8c8abb58866c30433 <span class="o">(</span>HEAD -&gt; master<span class="o">)</span>
Author: bugxch &lt;bugxch@gmail.com&gt;
Date:   Sun Apr <span class="m">15</span> 09:57:25 <span class="m">2018</span> +0800

    2rd commit

commit 8e740248d2d72e4188468094c7b4c4ccb0b5e050
Author: bugxch &lt;bugxch@gmail.com&gt;
Date:   Sun Apr <span class="m">15</span> 09:57:03 <span class="m">2018</span> +0800

    2nd commit

commit 2040c1ee8dc7bffd58fe0a206e97aa5a01db0275
Author: bugxch &lt;bugxch@gmail.com&gt;
Date:   Sun Apr <span class="m">15</span> 09:56:14 <span class="m">2018</span> +0800

    1st commit
</code></pre></td></tr></table>
</div>
</div><p>可以看出一共有 3 次提交，每个提交中包含自己的 commit_id，作者以及提交的具体时间。commit 之后的那一长串字母和数字，唯一标记每次 git 的提交，类似于 SVN 中的提交 id，之所以用这么一长串的十六进制的数字表示是为了避免很多人在同一版本库中提交时候发生冲突。如果提交的次数很多，这么看就比较长了，可以使用<code>git log --pretty=oneline</code>来查看比较简略的版本，如下所示</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git log --pretty<span class="o">=</span>oneline
1655db95f38ef46cf846e4e8c8abb58866c30433 <span class="o">(</span>HEAD -&gt; master<span class="o">)</span> 2rd commit
8e740248d2d72e4188468094c7b4c4ccb0b5e050 2nd commit
2040c1ee8dc7bffd58fe0a206e97aa5a01db0275 1st commit
</code></pre></td></tr></table>
</div>
</div><p>仅仅包含每次提交的 id 以及说明，看起来一目了然。此外还可以使用<code>gitk</code>使用图形化界面查看提交历史，如下图所示</p>
<p></p>
<h3 id="撤销修改">撤销修改</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">git checkout -- &lt;file&gt; //撤销对workspace中文件file的修改
git reset HEAD &lt;file&gt;  //撤销对暂存区中文件file的修改
git commit --amend     //撤销本地仓库的上一次提交，并编辑新的说明重新提交
</code></pre></td></tr></table>
</div>
</div><p>如果发现代码修改有问题，就需要撤销修改，这里依照不同的存储位置，分为如下三种情况。</p>
<h4 id="撤销-workspace-中的修改">撤销 workspace 中的修改</h4>
<p>我在<code>readme.txt</code>文件中不小心添加了一行字，文件内容如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">This is the 1st line of the file.
this is the 2nd lines
my boss is a idiot
</code></pre></td></tr></table>
</div>
</div><p>幸好及时发现，我们现在要做的就是将最后一行去掉，依然使用<code>git status</code>查看工作区的文件，可以看到如下的结果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git status
On branch master
Changes not staged <span class="k">for</span> commit:
  <span class="o">(</span>use <span class="s2">&#34;git add &lt;file&gt;...&#34;</span> to update what will be committed<span class="o">)</span>
  <span class="o">(</span>use <span class="s2">&#34;git checkout -- &lt;file&gt;...&#34;</span> to discard changes in working directory<span class="o">)</span>
        modified:   readme.txt
no changes added to commit <span class="o">(</span>use <span class="s2">&#34;git add&#34;</span> and/or <span class="s2">&#34;git commit -a&#34;</span><span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>明显可以看出文件的修改还没有被跟踪，而且提示我们使用<code>git checkout -- &lt;file&gt;</code>来放弃对工作区文件的修改，那我们试试看输入<code>git checkout -- readme.txt</code>，使用该命令后果然最后一行不见了。</p>
<h4 id="撤销暂存区中的修改">撤销暂存区中的修改</h4>
<p>依然以上面的文件为例，我在文件末尾添加那一句<code>my boss is an idiot</code>，之后使用<code>git add readme.txt</code>添加到暂存库，查看状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git status
On branch master
Changes to be committed:
  <span class="o">(</span>use <span class="s2">&#34;git reset HEAD &lt;file&gt;...&#34;</span> to unstage<span class="o">)</span>

        modified:   readme.txt
</code></pre></td></tr></table>
</div>
</div><p>提示我可以使用<code>git reset HEAD &lt;file&gt;</code>放弃修改，使用该命令看看</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git reset HEAD readme.txt
Unstaged changes after reset:
M       readme.txt
$ git status
On branch master
Changes not staged <span class="k">for</span> commit:
  <span class="o">(</span>use <span class="s2">&#34;git add &lt;file&gt;...&#34;</span> to update what will be committed<span class="o">)</span>
  <span class="o">(</span>use <span class="s2">&#34;git checkout -- &lt;file&gt;...&#34;</span> to discard changes in working directory<span class="o">)</span>

        modified:   readme.txt
</code></pre></td></tr></table>
</div>
</div><p>可以看出修改又回复到之前在工作区的状态，继续使用<code>git checkout -- readme.txt</code>彻底撤销之前的修改。</p>
<h4 id="撤销本地仓库中的修改">撤销本地仓库中的修改</h4>
<p>之前的撤销相对比较容易，如果已经提交到了本地仓库该撤销修改呢？现在我们修改<code>readme.txt</code>文件为如下内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">This is the 1st line of the file.
this is the 2nd lines
my boss is a idiot
</code></pre></td></tr></table>
</div>
</div><p>然后<code>git add .</code>,<code>git commit -m &quot;hahahaha&quot;</code>，这样就提交到了本地仓库，查看提交历史，如下所示</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git log --pretty<span class="o">=</span>oneline
498ebae5cbbb94a9fc1c549b1bd0cdc2fea5c886 hahahahaha
72b68e57aa9b18fcdd031d5901407a83c408580e revert the file
b250f9715a00d5f72caee1b6d0d7ab1d69e9c27b 2nd modification
27ed1eb9e7fb8a20176618e54c0464e721537da7 the 1st commit
abbd1c9e580a35aefe453615620d27ab464066c7 第一次提交readme.txt
</code></pre></td></tr></table>
</div>
</div><p>代码已经提交了。可以使用<code>git reset --hard HEAD^</code>放弃这次修改。这条指令的解析如下</p>
<ul>
<li><code>git reset</code>，表示回退，这个指令既可以将暂存区的数据回退到工作区，也可以回退版本。</li>
<li><code>--hard</code>，表示回退版本的同时，将工作区和暂存区的文件内容也同步回退，这里还有两个选项，具体见下表</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hard</code></td>
<td>仅仅回退版本，修改工作区和暂存区文件</td>
</tr>
<tr>
<td><code>mixed</code></td>
<td>回退版本，修改暂存区文件，不修改工作区</td>
</tr>
<tr>
<td><code>merge</code></td>
<td>回退版本，修改暂存区文件，修改工作区中那些被跟踪的文件</td>
</tr>
<tr>
<td><code>soft</code></td>
<td>仅仅回退版本，不修改工作区和暂存区文件</td>
</tr>
</tbody>
</table>
<ul>
<li><code>HEAD</code>表示当前版本的指针所在，<code>HAED^</code>表示前一个版本，<code>HEAD^^</code>表示之前两个版本，如果是前 100 个版本则可以使用<code>HEAD~100</code>。</li>
</ul>
<p>使用该命令之后的结果如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git log --pretty<span class="o">=</span>oneline
72b68e57aa9b18fcdd031d5901407a83c408580e revert the file
b250f9715a00d5f72caee1b6d0d7ab1d69e9c27b 2nd modification
27ed1eb9e7fb8a20176618e54c0464e721537da7 the 1st commit
abbd1c9e580a35aefe453615620d27ab464066c7 第一次提交readme.txt
</code></pre></td></tr></table>
</div>
</div><p>此外，也可以直接指定版本号，回退到特定的版本，比如我想回退到最早的那个版本，可以使用如下的命令<code>git reset --hard abbd1c</code>，后面的版本号就是第一次提交的 commit_id 的前几位，不必全部都写全，系统可以区分其他版本即可。输出结果如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git reset --hard abbd1c
HEAD is now at abbd1c9 第一次提交readme.txt
$ git log --pretty<span class="o">=</span>oneline
abbd1c9e580a35aefe453615620d27ab464066c7 第一次提交readme.txt
</code></pre></td></tr></table>
</div>
</div><p>现在已经回退到之前最早的版本了。</p>
<h4 id="误删怎么办">误删怎么办</h4>
<p>如果误删，可以使用<code>git reflog</code>，它记录了我们所有的操作，可以看到之前的 commit_id 以及对应的说明，如下所示</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git reflog
abbd1c9 HEAD@<span class="o">{</span>0<span class="o">}</span>: reset: moving to abbd1c
72b68e5 HEAD@<span class="o">{</span>1<span class="o">}</span>: reset: moving to HEAD^
498ebae HEAD@<span class="o">{</span>2<span class="o">}</span>: commit: hahahahaha
72b68e5 HEAD@<span class="o">{</span>3<span class="o">}</span>: reset: moving to HEAD^
461cb5a HEAD@<span class="o">{</span>4<span class="o">}</span>: commit: hahhaha
72b68e5 HEAD@<span class="o">{</span>5<span class="o">}</span>: reset: moving to HEAD^
7ea5d40 HEAD@<span class="o">{</span>6<span class="o">}</span>: commit: my boss hahaha
72b68e5 HEAD@<span class="o">{</span>7<span class="o">}</span>: commit: revert the file
b250f97 HEAD@<span class="o">{</span>8<span class="o">}</span>: commit: 2nd modification
27ed1eb HEAD@<span class="o">{</span>9<span class="o">}</span>: commit <span class="o">(</span>amend<span class="o">)</span>: the 1st commit
7aecba8 HEAD@<span class="o">{</span>10<span class="o">}</span>: commit: 1st commit
abbd1c9 HEAD@<span class="o">{</span>11<span class="o">}</span>: reset: moving to abbd1c
3325ee6 HEAD@<span class="o">{</span>12<span class="o">}</span>: commit: 1st commit
52c2155 HEAD@<span class="o">{</span>13<span class="o">}</span>: commit: 1st commit
abbd1c9 HEAD@<span class="o">{</span>14<span class="o">}</span>: commit <span class="o">(</span>initial<span class="o">)</span>: 第一次提交readme.txt
</code></pre></td></tr></table>
</div>
</div><p>如果要恢复到<code>hahahaha</code>的版本，可以使用如下的指令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ git reset --hard 461cb5a
HEAD is now at 461cb5a hahhaha

$ git log --pretty<span class="o">=</span>oneline
461cb5a8f35e5dc2b8dd4917d825b1b2d3c9bce3 hahhaha
72b68e57aa9b18fcdd031d5901407a83c408580e revert the file
b250f9715a00d5f72caee1b6d0d7ab1d69e9c27b 2nd modification
27ed1eb9e7fb8a20176618e54c0464e721537da7 the 1st commit
abbd1c9e580a35aefe453615620d27ab464066c7 第一次提交readme.txt
</code></pre></td></tr></table>
</div>
</div><p>修改成功~</p>
<hr>
<p>所有上面的操作可以总结在如下的一张图里</p>
<p></p>
<h2 id="参考资料">参考资料</h2>
<ul>
<li><a href="https://try.github.io/levels/1/challenges/19" target="_blank" rel="noopener noreffer">Git Tutorial - Try Git</a></li>
<li><a href="https://www.jianshu.com/p/06e1f67c8939" target="_blank" rel="noopener noreffer">Git 与 Repo 简单入门 - 简书</a></li>
<li><a href="http://iissnan.com/progit/" target="_blank" rel="noopener noreffer">Pro Git 简体中文版</a>，非常全面的 git 小书</li>
<li><a href="https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000" target="_blank" rel="noopener noreffer">Git 教程 - 廖雪峰的官方网站</a>，有对应的 ios 的 <a href="https://www.liaoxuefeng.com/webpage/gitapp" target="_blank" rel="noopener noreffer">Git App for iOS - 廖雪峰的官方网站</a></li>
<li><a href="https://marklodato.github.io/visual-git-guide/index-zh-cn.html" target="_blank" rel="noopener noreffer">图解 Git</a></li>
</ul>]]></description>
</item></channel>
</rss>
